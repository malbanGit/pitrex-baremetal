
//  0x50, 0x09
unsigned char uniDirectional[] =
{
  0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000101, 0b00000000, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00001111, 0b11100000, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00111111, 0b11110000, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b01111111, 0b11111000, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000011, 0b11111001, 0b11111111, 0b11111100, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000111, 0b11111111, 0b11111111, 0b11111110, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00001111, 0b11111111, 0b11111111, 0b11111111, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00001111, 0b11111111, 0b11111111, 0b11111111, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00011111, 0b11111111, 0b11111111, 0b11111111, 0b10000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00011111, 0b11111111, 0b11111111, 0b11111111, 0b11000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00111111, 0b11111111, 0b11111111, 0b11111111, 0b11100000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00111111, 0b11111111, 0b11111111, 0b11111111, 0b11100000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00111111, 0b11111111, 0b11111111, 0b11111111, 0b11100000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b01111111, 0b11111111, 0b11111111, 0b11111111, 0b11100000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b01111111, 0b11111111, 0b11111111, 0b11111111, 0b11100000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b01111111, 0b11111111, 0b11111111, 0b11111111, 0b11100000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00111111, 0b11111111, 0b11111111, 0b11111111, 0b11100000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00111111, 0b11111111, 0b11111111, 0b11111111, 0b11110000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00111111, 0b11111111, 0b11111111, 0b11111111, 0b11110000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00111111, 0b11111111, 0b11111111, 0b11111111, 0b11110000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00011111, 0b11111111, 0b11111111, 0b11111111, 0b11111000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00011111, 0b11111111, 0b11111111, 0b11111111, 0b11111000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00011111, 0b11111111, 0b11111111, 0b11110111, 0b11111000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00111111, 0b11111111, 0b11111111, 0b00000000, 0b10111000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00001111, 0b11111111, 0b11111000, 0b00000000, 0b00111000, 0b11000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b01111111, 0b11111000, 0b00011111, 0b01111000, 0b11000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b00111111, 0b11111000, 0b00000111, 0b11111000, 0b11000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00111000, 0b00001111, 0b11110000, 0b00000001, 0b11111000, 0b11100000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00100000, 0b00000111, 0b11100010, 0b00010001, 0b11111101, 0b11100000, 0b00000000, //forward
  0b00000000, 0b00010000, 0b11000000, 0b01000011, 0b11000011, 0b00011111, 0b11111101, 0b11000000, 0b00000000, //forward
  0b00000000, 0b00010000, 0b11000100, 0b01001011, 0b11001111, 0b11111111, 0b11111101, 0b11000000, 0b00000000, //forward
  0b00000000, 0b00010000, 0b11100100, 0b11111001, 0b11011111, 0b11111111, 0b11111101, 0b11000000, 0b00000000, //forward
  0b00000000, 0b00001001, 0b11111111, 0b11111001, 0b11011111, 0b11111111, 0b11111001, 0b11000000, 0b00000000, //forward
  0b00000000, 0b00001001, 0b11111111, 0b11111101, 0b11111111, 0b11111111, 0b11111001, 0b11000000, 0b00000000, //forward
  0b00000000, 0b00001001, 0b11111111, 0b11111001, 0b11111111, 0b11111111, 0b11111001, 0b11000000, 0b00000000, //forward
  0b00000000, 0b00001001, 0b11111111, 0b11111001, 0b11001111, 0b11111111, 0b11110001, 0b11000000, 0b00000000, //forward
  0b00000000, 0b00001001, 0b11111111, 0b11111001, 0b11001111, 0b11111111, 0b11110001, 0b11000000, 0b00000000, //forward
  0b00000000, 0b00000001, 0b11111111, 0b11111001, 0b11101111, 0b11111111, 0b11110001, 0b10000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b11111111, 0b11111011, 0b11100011, 0b11111111, 0b11110011, 0b10000000, 0b00000000, //forward
  0b00000000, 0b00000100, 0b11111111, 0b11110011, 0b11110011, 0b11111111, 0b11110011, 0b10000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b11111111, 0b11100011, 0b11111001, 0b11111111, 0b11110011, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000010, 0b01111111, 0b11100111, 0b11111111, 0b11111111, 0b11110000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000010, 0b01111111, 0b11101011, 0b11100011, 0b11111111, 0b11110000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b01111111, 0b11110000, 0b11000111, 0b11111111, 0b11110000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00111111, 0b11111000, 0b00011111, 0b11111111, 0b11110000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00111111, 0b11111111, 0b11111111, 0b11111111, 0b11110000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00111111, 0b11111111, 0b11111001, 0b10111111, 0b11100000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00011111, 0b10000111, 0b11111101, 0b11011111, 0b11100000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00011111, 0b10011111, 0b11111111, 0b11111111, 0b11100000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00011111, 0b11111111, 0b11111110, 0b00111111, 0b11100000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00011111, 0b11110111, 0b11100000, 0b00111111, 0b11000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00011111, 0b11000000, 0b00000001, 0b11111111, 0b10010000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00001111, 0b11100000, 0b00111111, 0b11111111, 0b10010000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000111, 0b11111111, 0b11111111, 0b11111111, 0b00110000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000011, 0b11111111, 0b11101111, 0b11111110, 0b00110000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000001, 0b11111100, 0b00000011, 0b11111110, 0b01110000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b11111110, 0b00011111, 0b11111100, 0b01100000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b01111111, 0b11111111, 0b11111000, 0b11110000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b01111111, 0b11111111, 0b11110001, 0b11110000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b00111111, 0b11111111, 0b11100011, 0b11100000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b00011111, 0b11111111, 0b11000111, 0b11100000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b00001111, 0b11111111, 0b10001111, 0b11100000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b00000011, 0b11111101, 0b00011111, 0b11100000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000000, 0b00000001, 0b11111000, 0b00111111, 0b11000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000001, 0b00000000, 0b00000000, 0b01111111, 0b11000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00000001, 0b11111111, 0b10000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000001, 0b10000000, 0b00111111, 0b11111111, 0b10000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000001, 0b11000011, 0b11111111, 0b11111110, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000001, 0b11100001, 0b11111111, 0b11110000, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000001, 0b11110001, 0b11111111, 0b11000000, 0b00000000, 0b00000000, 0b00000000, //forward
  0b00000000, 0b00000000, 0b00000001, 0b11111100, 0b11111110, 0b00000000, 0b00000000, 0b00000000, 0b00000000, //forward
};

void v_directMove32n(int32_t xEnd, int32_t yEnd)
{
  v_zeroWait();
  int32_t x = xEnd*sizeX+offsetX;
  int32_t y = yEnd*sizeY+offsetY;

  UNZERO(); // ensure vector beam can be moves
  SET_OPTIMAL_SCALE(x, y);
  SET_YSH16(y);
  SET_XSH16(x);
  START_T1_TIMER();
  consecutiveDraws=0;
  currentCursorX = x;
  currentCursorY = y;
  WAIT_T1_END();
}
void v_directFastDown(int32_t y)
{

  SET_YSH8(y);
  SET_XSH8(0);
  I_SET(VIA_port_b, 0x01); // enable ramp, mux = y integrator, disable mux
  ADD_DELAY_CYCLES(5);
  I_SET(VIA_port_b, 0x81); // disable ramp, mux = y integrator, disable mux
  SET_YSH8(0);
  I_SET(VIA_port_b, 0x81); // disable ramp, mux = y integrator, disable mux
}
// todo ADD to Pipeline
// 8 bit for now
void v_printBitmapUni(unsigned char *bitmapBlob, int width, int height, int sizeX, int x, int y)
{
//  v_readButtons(); 
//  bitmapBlob=uniDirectional;
//  width = 0x09;
//  height = 0x50;
//  x = -(9*4);
//  y = 0x28;
//    v_setBrightness(64);
  
    int patternAnds[] = {128,64,32,16,8,4,2,1};
    // uni directional
    
    for (int yy=0;yy<height;yy++)
    {
    currentYSH=currentPortA=0x100;

      v_directMove32n(x*128,(y-yy*2)*128);
////////////////
// Prepare line print


        int afterYDelay = 6; // cranky dependend
        if (crankyFlag & CRANKY_BETWEEN_VIA_B)
        {
            afterYDelay += crankyFlag&0x0f;
        }

        I_SET(VIA_port_b, 0x80);
        DELAY_PORT_B_BEFORE_PORT_A();
        I_SET(VIA_port_a, 0);

//        UNZERO();
        afterYDelay -= 2;

        if (crankyFlag & CRANKY_NULLING_WAIT)
        {
            // some crankies need additional waits here!
            afterYDelay += CRANKY_DELAY_Y_TO_NULL_VALUE;
        }
        if (afterYDelay>0)
          ADD_DELAY_CYCLES(afterYDelay);

        I_SET(VIA_port_b, 0x81);
        DELAY_PORT_B_BEFORE_PORT_A();
        I_SET(VIA_port_a, sizeX);
////////////////
        // prepare for raster output

        SET(VIA_aux_cntl, 0x00);
//ADD_DELAY_CYCLES(1);
        // now print one line pattern

        I_SET(VIA_port_b, 0x01); // enable ramp, mux = y integrator, disable mux
        for (int xx=0;xx<width;xx++)
        {
            for (int bit=0;bit<8;bit++)
            {
                // output one raster dot - or not
                if (*bitmapBlob & patternAnds[bit])
                {
                  SET(VIA_cntl, 0xee);
//                    SWITCH_BEAM_ON();
                }
                else
                {
                  SET(VIA_cntl, 0xce);
//                    SWITCH_BEAM_OFF();
                }
            }
            bitmapBlob++;
        }
        // switch off, if last bit was on!
        if (*bitmapBlob & 1)
            SET(VIA_cntl, 0xce);
        
        
        I_SET(VIA_port_b, 0x81); // disable ramp, mux = y integrator, disable mux
        // assume lightning is done CNTL
        SET (VIA_aux_cntl, 0x80); // Shift reg mode = 000 free disable, T1 PB7 enabled
    }
}

/*
// 8 bit for now
void v_printBitmapUniBi(unsigned char *bitmapBlob, int width, int height, int sizeX, int x, int y)
{
//  v_readButtons(); 
//  bitmapBlob=uniDirectional;
//  width = 0x09;
//  height = 0x50;
//  x = -(9*4);
//  y = 0x28;
//    v_setBrightness(64);
  
    v_directMove32n(x*128,y*128);
    int patternAnds[] = {128,64,32,16,8,4,2,1};
    // uni directional
    
    for (int yy=0;yy<height;yy++)
    {
      currentYSH=currentPortA=0x100;
        int afterYDelay = 6; // cranky dependend
        if (crankyFlag & CRANKY_BETWEEN_VIA_B)
        {
            afterYDelay += crankyFlag&0x0f;
        }

        I_SET(VIA_port_b, 0x80);
        DELAY_PORT_B_BEFORE_PORT_A();
        I_SET(VIA_port_a, 0);
        afterYDelay -= 2;

        if (crankyFlag & CRANKY_NULLING_WAIT)
        {
            // some crankies need additional waits here!
            afterYDelay += CRANKY_DELAY_Y_TO_NULL_VALUE;
        }
        if (afterYDelay>0)
          ADD_DELAY_CYCLES(afterYDelay);

        I_SET(VIA_port_b, 0x81);
        DELAY_PORT_B_BEFORE_PORT_A();
        I_SET(VIA_port_a, sizeX);
////////////////
        // prepare for raster output

        SET(VIA_aux_cntl, 0x00);
//ADD_DELAY_CYCLES(1);
        // now print one line pattern

        I_SET(VIA_port_b, 0x01); // enable ramp, mux = y integrator, disable mux
if (yy!=0) ADD_DELAY_CYCLES(21);
        for (int xx=0;xx<width;xx++)
        {
            for (int bit=0;bit<8;bit++)
            {
                // output one raster dot - or not
                if (*bitmapBlob & patternAnds[bit])
                {
                  vectrexwrite_short(VIA_cntl, 0xee);
//                    SWITCH_BEAM_ON();
                }
                else
                {
                  vectrexwrite_short(VIA_cntl, 0xce);
//                    SWITCH_BEAM_OFF();
                }
            }
            bitmapBlob++;
        }
        // switch off, if last bit was on!
        if (*bitmapBlob & 1) vectrexwrite_short(VIA_cntl, 0xce);
        I_SET(VIA_port_b, 0x81); // disable ramp, mux = y integrator, disable mux
        
        
        
        // and go back!
        yy++;
        if (yy<height)
        {
          v_directFastDown(-15);
          DELAY_PORT_B_BEFORE_PORT_A();

          int afterYDelay = 6; // cranky dependend
          if (crankyFlag & CRANKY_BETWEEN_VIA_B)
          {
              afterYDelay += crankyFlag&0x0f;
          }

          I_SET(VIA_port_b, 0x80);
          DELAY_PORT_B_BEFORE_PORT_A();
          I_SET(VIA_port_a, 0);
          afterYDelay -= 2;

          if (crankyFlag & CRANKY_NULLING_WAIT)
          {
              // some crankies need additional waits here!
              afterYDelay += CRANKY_DELAY_Y_TO_NULL_VALUE;
          }
          if (afterYDelay>0)
            ADD_DELAY_CYCLES(afterYDelay);

          I_SET(VIA_port_b, 0x81);
          DELAY_PORT_B_BEFORE_PORT_A();
            I_SET(VIA_port_a, -sizeX);
          
          
          I_SET(VIA_port_b, 0x01); // enable ramp, mux = y integrator, disable mux
ADD_DELAY_CYCLES(23);
          
          for (int xx=width-1;xx>=0;xx--)
          {
              for (int bit=7;bit>=0;bit--)
              {
                  // output one raster dot - or not
                  if (*(bitmapBlob+xx) & patternAnds[bit])
                  {
                    vectrexwrite_short(VIA_cntl, 0xee);
                  }
                  else
                  {
                    vectrexwrite_short(VIA_cntl, 0xce);
                  }
              }
          }
          if (*bitmapBlob & 128) vectrexwrite_short(VIA_cntl, 0xce);
          I_SET(VIA_port_b, 0x81); // disable ramp, mux = y integrator, disable mux
          
          bitmapBlob+=width;
          v_directFastDown(-15);
        }
    }
    SET (VIA_aux_cntl, 0x80); // Shift reg mode = 000 free disable, T1 PB7 enabled
}
*/
